[build]
command = "npm run build"
publish = "_site"

[build.environment]
NODE_VERSION = "22"

[[plugins]]
package = "netlify-plugin-webmentions"

[functions]
directory = "netlify/functions"
node_bundler = "esbuild"

# Micropub endpoints - use 200 status for rewrites (not redirects)
[[redirects]]
from = "/micropub"
to = "/.netlify/functions/micropub"
status = 200

[[redirects]]
from = "/media"
to = "/.netlify/functions/media"
status = 200

[[redirects]]
from = "/.well-known/host-meta*"
to = "https://fed.brid.gy/.well-known/host-meta:splat"
status = 302

[[redirects]]
from = "/.well-known/webfinger*"
to = "https://fed.brid.gy/.well-known/webfinger"
status = 302

# Post-deploy webhook endpoint
[[redirects]]
from = "/post-deploy"
to = "/.netlify/functions/post-deploy"
status = 200
